!function(t,i){"object"==typeof exports&&"undefined"!=typeof module?i(exports):"function"==typeof define&&define.amd?define(["exports"],i):i((t=t||self).AEP={})}(this,function(t){"use strict";var y={author:"shrek.wang - https://github.com/shrekshrek",version:"0.10.0",loadOrder:0,alphaTest:.05,curveSegments:10,lockWidth:!1,far:5e4,near:1,width:0,height:0,frameSegments:10,canvas:null,THREE:null};function p(t,i){wx.request({url:t,success(t){i(t.data)}})}function u(t,i,e){var s=y.canvas.createImage();s.onload=s.onerror=function(){i(s,e)},s.src=t}var O=new RegExp(".+/(.+)$"),I=new RegExp("[^\\.]\\w*$");function a(t){return Math.floor(t*y.frameSegments)/y.frameSegments}Date.now=Date.now||function(){return(new Date).getTime()};var H=Date.now();function o(){return Date.now()-H}var l=[],c=[],d=[],m=[],f=!1,_=0;function g(){var t=l.length,i=d.length;if(0===t&&0===i)f=!1;else{var e=o(),s=e-_;_=e,500<s&&(s=33),c=l.slice(0);for(var a=0;a<t;a++){var h=c[a];h&&h.isPlaying&&!h._updateTime(s)&&h.pause()}m=d.slice(0);for(var r=0;r<i;r++){var n=m[r];n&&n.isSoloPlaying&&n._updateSoloTime(s)}y.canvas.requestAnimationFrame(g)}}function e(t,i){this._frameRate=0,this._frameStep=0,this.totalTime=0,this.curTime=null,this.lastTime=null,this.timeScale=1,this.isPlaying=!1,this.isReverse=!1,this.isSoloPlaying=!1,this.soloItems=null,this.loop=i.loop||!1,this.isSeek=!1,this.isKeep=!1,this.setFrameRate(t.fr),this.onStart=i.onStart||null,this.onEnd=i.onEnd||null,this.onUpdate=i.onUpdate||null}Object.assign(e.prototype,{_updateTime:function(t){this.isKeep=!1,t=(this.isReverse?-1:1)*t*this.timeScale;var i=this.curTime,e=(this.loop&&(0===this.curTime&&t<0?i=this.totalTime:this.curTime===this.totalTime&&0<t&&(i=0)),Math.min(this.totalTime,Math.max(0,i+t)));if(e!==this.curTime){this.lastTime=i,this.curTime=e;i=a(this.curTime/this._frameStep);if(this._seekFrame(i+this.inFrame),!this.isSeek&&this.onUpdate&&this.onUpdate(t),this.lastTime<this.curTime){if(this.lastTime<=0&&0<this.curTime&&!this.isSeek&&this.onStart&&this.onStart(),this.lastTime<this.totalTime&&this.curTime>=this.totalTime)return!this.isSeek&&this.onEnd&&this.onEnd(),this.loop||this.isKeep}else if(this.lastTime>=this.totalTime&&this.curTime<this.totalTime&&!this.isSeek&&this.onEnd&&this.onEnd(),0<this.lastTime&&this.curTime<=0)return!this.isSeek&&this.onStart&&this.onStart(),this.loop||this.isKeep}return!0},_updateSoloTime:function(t){t=(this.isReverse?-1:1)*t*this.timeScale;for(var i=0,e=this.soloItems.length;i<e;i++)this.soloItems[i]._soloFrame(t/this._frameStep);this.isPlaying||this.isSeek||!this.onUpdate||this.onUpdate(t)},getFrameRate:function(){return this._frameRate},setFrameRate:function(t){this._frameRate=t,this._frameStep=1e3/this._frameRate,this.totalTime=this._frameStep*(this.outFrame-this.inFrame)},seek:function(t,i){t=Math.max(0,Math.min(this.totalTime,t));this.curTime!==t&&(this.isSeek=i||!1,this._updateTime((this.isReverse?-1:1)*(t-this.curTime)),this.isSeek=!1)},prev:function(){this.seek(this.curTime-this._frameStep)},next:function(){this.seek(this.curTime+this._frameStep)},play:function(t){if(this.isReverse=!1,void 0!==t&&this.seek(t,!0),!this.loop&&this.curTime===this.totalTime)return this.isKeep=!1;this.isKeep=!0,this.isPlaying||(this.isPlaying=!0,this._addTimeline())},pause:function(){this.isKeep=!1,this.isPlaying&&(this.isPlaying=!1,this._removeTimeline())},stop:function(){this.pause(),this.curTime=0},reverse:function(t){if(this.isReverse=!0,void 0!==t&&this.seek(t,!0),!this.loop&&0===this.curTime)return this.isKeep=!1;this.isKeep=!0,this.isPlaying||(this.isPlaying=!0,this._addTimeline())},_addTimeline:function(){l.push(this),f||(_=o(),f=!0,y.canvas.requestAnimationFrame(g))},_removeTimeline:function(){var t=l.indexOf(this);-1!==t&&l.splice(t,1)},solo:function(t){if(this.soloItems){for(var i=0,e=this.soloItems.length;i<e;i++)this.soloItems[i].isSolo=!1;this.soloItems=null,this.pauseSolo()}if(t&&t.length){this.soloItems=[];for(i=0,e=t.length;i<e;i++)"comp"==t[i].type&&(t[i].isSolo=!0,this.soloItems.push(t[i]));this.playSolo()}else t&&"comp"==t.type&&(t.isSolo=!0,this.soloItems=[t],this.playSolo())},playSolo:function(){!this.isSoloPlaying&&this.soloItems&&(this.isSoloPlaying=!0,this._addSoloTimeline())},pauseSolo:function(){this.isSoloPlaying&&(this.isSoloPlaying=!1,this._removeSoloTimeline())},_addSoloTimeline:function(){d.push(this),f||(_=o(),f=!0,y.canvas.requestAnimationFrame(g))},_removeSoloTimeline:function(){var t=d.indexOf(this);-1!==t&&d.splice(t,1)}});i={getBezierEasing:function(t,i,e,s,a){a=a||("bez_"+t+"_"+i+"_"+e+"_"+s).replace(/\./g,"p");if(h[a])return h[a];t=new n([t,i,e,s]);return h[a]=t}},h={},E=1/((R=11)-1),s="function"==typeof Float32Array,n.prototype={get:function(t){var i=this._p[0],e=this._p[1],s=this._p[2],a=this._p[3];return this._precomputed||this._precompute(),i===e&&s===a?t:0===t?0:1===t?1:x(this._getTForX(t),e,a)},_precompute:function(){var t=this._p[0],i=this._p[1],e=this._p[2],s=this._p[3];this._precomputed=!0,t===i&&e===s||this._calcSampleValues()},_calcSampleValues:function(){for(var t=this._p[0],i=this._p[2],e=0;e<R;++e)this._mSampleValues[e]=x(e*E,t,i)},_getTForX:function(t){for(var i=this._p[0],e=this._p[2],s=this._mSampleValues,a=0,h=1,r=R-1;h!==r&&s[h]<=t;++h)a+=E;var n=a+(t-s[--h])/(s[h+1]-s[h])*E,o=A(n,i,e);if(.001<=o){for(var l=t,p=n,u=i,c=e,d=0;d<4;++d){var m=A(p,u,c);if(0===m)return p;p-=(x(p,u,c)-l)/m}return p}if(0===o)return n;for(var f,_,y=t,g=a,v=a+E,S=i,w=e,T=0;0<(f=x(_=g+(v-g)/2,S,w)-y)?v=_:g=_,1e-7<Math.abs(f)&&++T<10;);return _}};var i,h,R,E,s,v=i;function r(t,i){return 1-3*i+3*t}function x(t,i,e){return((r(i,e)*t+(3*e-6*i))*t+3*i)*t}function A(t,i,e){return 3*r(i,e)*t*t+2*(3*e-6*i)*t+3*i}function n(t){this._p=t,this._mSampleValues=new(s?Float32Array:Array)(R),this._precomputed=!1,this.get=this.get.bind(this)}S={};var S,D={buildBezierData:function(t,i){var e=t.s,s=t.e,a=t.to,h=t.ti,t=(e.join("_")+"_"+s.join("_")+"_"+a.join("_")+"_"+h.join("_")).replace(/\./g,"p");if(S[t])return S[t];for(var r,n,o,l,p,u=Math.max(Math.min(Math.round(i),y.curveSegments),2),c=0,d=null,m=new B(u),f=a.length,_=0;_<u;_+=1){for(p=new Array(f),o=_/(u-1),r=l=0;r<f;r+=1)n=Math.pow(1-o,3)*e[r]+3*Math.pow(1-o,2)*o*(e[r]+a[r])+3*(1-o)*Math.pow(o,2)*(s[r]+h[r])+Math.pow(o,3)*s[r],p[r]=n,null!==d&&(l+=Math.pow(p[r]-d[r],2));c+=l=Math.sqrt(l),m.points[_]=new L(c,l,p),d=p}return m.segmentLength=c,S[t]=m}};function B(t){this.segmentLength=0,this.points=new Array(t)}function L(t,i,e){this.length=t,this.ptDistance=i,this.point=e}function w(t){this.data=t,this.frames=[],this.easings=[],this.beziers=[]}function T(t,i){if(this.name=t,this.isAnim=1===i.a,"or"==this.name&&this.isAnim){var e,s=i;for(e in s.k){var a,h=s.k[e];for(a in h.s)h.to[a]=h.ti[a]=0,180<h.e[a]-h.s[a]&&(h.s[a]+=360),h.e[a]-h.s[a]<-180&&(h.s[a]-=360)}}this.isAnim?this.keys=new w(i.k):this.value=i.k}function z(t,i){if(t&&t.length){for(var e in t)if(t[e]!==i[e])return;return 1}return t===i}function b(t,i){for(var e in this.data=t,this.type="",this.name=t.nm,this.size={width:0,height:0},this.startFrame=t.st||0,this.inFrame=t.ip,this.outFrame=t.op,this.curFrame=null,this.curSoloFrame=null,this.curUpdateFrame=null,this.scaleRate=t.sr||1,this.parentLayer=null,this.parent=i,this.property={},t.tf)"p"===e&&!0===t.tf[e].s?(t.tf[e].x&&(this.property.x=new T("x",t.tf[e].x)),t.tf[e].y&&(this.property.y=new T("y",t.tf[e].y)),t.tf[e].z&&(this.property.z=new T("z",t.tf[e].z))):this.property[e]=new T(e,t.tf[e]);this.visible=!1,this.positionUpdate=!1,this.rotateUpdate=!1,this.needsUpdate=!1,this.isMoved=!1,this.isClosed=!1,this._a=null,this._o=null,this._s=null,this._or=null,this._rx=null,this._ry=null,this._rz=null,this._p=null,this._x=null,this._y=null,this._z=null}function F(t,i){b.call(this,t,i),this.orientEuler=new y.THREE.Euler,this.orientQuat=new y.THREE.Quaternion,this.anchorMatrix=new y.THREE.Matrix4}function k(t,i,e){F.call(this,t,i),this.type="image",this.image=e,this.size={width:this.image.w,height:this.image.h},this.mat=new y.THREE.MeshBasicMaterial({map:this.image.texture,side:y.THREE.DoubleSide,transparent:!0,alphaTest:y.alphaTest}),this.geo=new y.THREE.PlaneBufferGeometry(this.size.width,this.size.height,1,1),this.el=new y.THREE.Mesh(this.geo,this.mat),(this.el.le=this).el.matrixAutoUpdate=!1}function M(t,i){F.call(this,t,i),this.type="solid",this.size={width:t.sw,height:t.sh},this.mat=new y.THREE.MeshBasicMaterial({color:Number("0x"+t.sc.substring(1)),side:y.THREE.DoubleSide,transparent:!0}),this.geo=new y.THREE.PlaneBufferGeometry(this.size.width,this.size.height,1,1),this.el=new y.THREE.Mesh(this.geo,this.mat),(this.el.le=this).el.matrixAutoUpdate=!1}function C(t,i){F.call(this,t,i),this.type="null object",this.el=new y.THREE.Object3D,(this.el.le=this).el.matrixAutoUpdate=!1}function U(t,i){F.call(this,t,i),this.type="camera",this.target=null;i=y.lockWidth?this.parent.size.width*y.height/y.width:this.parent.size.height,i=2*Math.atan(i/2/t.pe.k)/Math.PI*180;this.el=new y.THREE.PerspectiveCamera(i,y.width/y.height,y.near,y.far),(this.el.le=this).el.matrixAutoUpdate=!1,this.rotateEuler=new y.THREE.Euler,this.rotateQuat=new y.THREE.Quaternion}function P(t,i,e,s,a){F.call(this,t,i),this.type="comp",this.imageAssets=s,this.compAssets=a,this.size={width:t.w,height:t.h},this.el=new y.THREE.Group,(this.el.le=this).el.matrixAutoUpdate=!1,this.workStart=t.ws,this.workDuration=t.wd,this.isSolo=!1,this.layers=[],this.cameras=[],this.activeCamera=null,this._initLayers(e.layers)}function j(t,i){this.path=i&&i.path,this.imageAssets={},this.compAssets={},this.assets=i&&i.assets||{},this._initImages(t.images),this._initComps(t.comps),P.call(this,t,null,t,this.imageAssets,this.compAssets),e.call(this,t,i),this.type="animation",this.defaultZ=2666,this.defaultCamera=new y.THREE.PerspectiveCamera(75,y.width/y.height,y.near,y.far),this.defaultCamera.position.set(0,0,this.defaultZ),this.activeCamera=this.defaultCamera,this.setSize(i.width||y.width,i.height||y.height)}Object.assign(w.prototype,{update:function(t){if(!this.frames[t]){for(var i=this.data.length,e=i-1;0<=e;e--){var s=this.data[e];if(t>=s.t){if(e==i-1)this.frames[t]=this.data[e-1].e;else{if(void 0===this.easings[e])if(s.o.x.constructor===Array){var a,h=[];for(a in s.o.x)h[a]=v.getBezierEasing(s.o.x[a],s.o.y[a],s.i.x[a],s.i.y[a],s.n[a]).get;this.easings[e]=h}else this.easings[e]=v.getBezierEasing(s.o.x,s.o.y,s.i.x,s.i.y,s.n).get;var r=this.easings[e],n=(t-s.t)/(this.data[e+1].t-s.t),o=[];if(s.to){void 0===this.beziers[e]&&(this.beziers[e]=D.buildBezierData(s,this.data[e+1].t-s.t));var l=this.beziers[e];for(_ in s.s){for(var p=r.constructor===Array?r[_](n):r(n),u=l.segmentLength*p,c=1,d=l.points.length,m=0;m<d;m++)if(u<l.points[m].length){c=m;break}var f=0!=l.points[c].ptDistance?(u-l.points[c-1].length)/l.points[c].ptDistance:0;o[_]=l.points[c].point[_]*f+l.points[c-1].point[_]*(1-f)}}else for(var _ in s.s){var y=s.s,g=s.e,p=r.constructor===Array?r[_](n):r(n);o[_]=y[_]+(g[_]-y[_])*p}this.frames[t]=o}return this.frames[t]}}this.frames[t]=this.data[0].s}return this.frames[t]}}),Object.assign(T.prototype,{update:function(t){return this.isAnim?this.keys.update(t):this.value}}),Object.assign(b.prototype,{open:function(){return this.isClosed=!1,this.visible&&this._addSelf(),this},close:function(){return this.isClosed=!0,this.el.parent&&this.el.parent.remove(this.el),this},_seekFrame:function(t){if(!this.isClosed&&this.curFrame!==t)if(this.curFrame=t,this.curFrame>=this.inFrame&&this.curFrame<this.outFrame){if(this.visible?this._update(this.curFrame,!1):(this.visible=!0,this._addSelf(),this._update(this.curFrame,!0)),this.layers&&!this.isSolo)for(var i=0,e=this.layers.length;i<e;i++){var s=this.layers[i];s&&s._seekFrame((this.curFrame-this.startFrame)/this.scaleRate)}}else this.visible&&(this.visible=!1,this._removeSelf())},_soloFrame:function(t){if(this.visible){t=a((this.curSoloFrame+t-this.workStart)%this.workDuration);if(this.curSoloFrame=this.workStart+t+(t<0?this.workDuration:0),this.layers&&this.isSolo)for(var i=0,e=this.layers.length;i<e;i++){var s=this.layers[i];s&&s._seekFrame(this.curSoloFrame/this.scaleRate)}}},_addSelf:function(){},_removeSelf:function(){},_update:function(t,i){var e;this.curUpdateFrame!==t&&(this.curUpdateFrame=t,this.positionUpdate=!1,this.rotateUpdate=!1,this.needsUpdate=!1,this.isMoved=!1,this.property.o&&(e=this.property.o.update(t),this.parent&&(e*=(this.parent._o||100)/100),z(this._o,e)||(this._o=e,this._updateO())),this.property.p&&(e=this.property.p.update(t),z(this._p,e)||(this.isMoved=!0,this._p=e,this._x=e[0],this._y=e[1],this._z=e[2],this.positionUpdate=!0)),this.property.x&&(e=this.property.x.update(t),z(this._x,e)||(this.isMoved=!0,this._x=e,this.positionUpdate=!0)),this.property.y&&(e=this.property.y.update(t),z(this._y,e)||(this.isMoved=!0,this._y=e,this.positionUpdate=!0)),this.property.z&&(e=this.property.z.update(t),z(this._z,e)||(this.isMoved=!0,this._z=e,this.positionUpdate=!0)),this.positionUpdate&&(this._updateP(),this.needsUpdate=!0),this.property.a&&(e=this.property.a.update(t),("camera"===this.type&&this.isMoved||!z(this._a,e))&&(this._a=e,this._updateA(),this.needsUpdate=!0)),this.property.s&&(e=this.property.s.update(t),z(this._s,e)||(this._s=e,this._updateS(),this.needsUpdate=!0)),this.property.rx&&(e=this.property.rx.update(t),z(this._rx,e)||(this._rx=e,this.rotateUpdate=!0)),this.property.ry&&(e=this.property.ry.update(t),z(this._ry,e)||(this._ry=e,this.rotateUpdate=!0)),this.property.rz&&(e=this.property.rz.update(t),z(this._rz,e)||(this._rz=e,this.rotateUpdate=!0)),this.property.or&&(e=this.property.or.update(t),z(this._or,e)||(this._or=e,this.rotateUpdate=!0)),this.rotateUpdate&&(this._updateR(),this.needsUpdate=!0),this.needsUpdate&&this._updateSelf(),this.parentLayer&&(this.parentLayer._update(t),(this.parentLayer.needsUpdate||this.needsUpdate||i)&&(this.needsUpdate||(this._updateSelf(),this.needsUpdate=!0),this._updateFromParent())))},_updateO:function(){},_updateP:function(){},_updateA:function(){},_updateS:function(){},_updateR:function(){},_updateSelf:function(){},_updateFromSelf:function(){},_updateFromParent:function(){}}),F.Radian=Math.PI/180,F.prototype=Object.assign(Object.create(b.prototype),{constructor:F,_updateO:function(){this.mat.opacity=this._o/100},_updateP:function(){var t=this.parent?this.parent.size.width:0,i=this.parent?this.parent.size.height:0;this.el.position.set(this._x-t/2,-this._y+i/2,-this._z)},_updateA:function(){this.anchorMatrix.makeTranslation(-this._a[0]+this.size.width/2,this._a[1]-this.size.height/2,this._a[2])},_updateS:function(){this.el.scale.set(this._s[0]/100,this._s[1]/100,this._s[2]/100)},_updateR:function(){this.el.rotation.set(this._rx*F.Radian,-this._ry*F.Radian,-this._rz*F.Radian),0===this._or[0]&&0===this._or[1]&&0===this._or[2]||(this.orientEuler.set(this._or[0]*F.Radian,-this._or[1]*F.Radian,-this._or[2]*F.Radian),this.orientQuat.setFromEuler(this.orientEuler,!1),this.el.quaternion.premultiply(this.orientQuat))},_updateSelf:function(){this.el.updateMatrix(),"camera"!=this.type&&this.el.matrix.multiplyMatrices(this.el.matrix,this.anchorMatrix)},_updateFromParent:function(){var t=this.parent?this.parent.size.width:0,i=this.parent?this.parent.size.height:0;this.el.matrix.elements[12]+=t/2-this.parentLayer.size.width/2,this.el.matrix.elements[13]-=i/2-this.parentLayer.size.height/2,this.el.matrix.multiplyMatrices(this.parentLayer.el.matrix,this.el.matrix),this.el.matrixWorldNeedsUpdate=!0}}),k.prototype=Object.assign(Object.create(F.prototype),{constructor:k}),M.prototype=Object.assign(Object.create(F.prototype),{constructor:M}),C.prototype=Object.assign(Object.create(F.prototype),{constructor:C,_updateO:function(t,i){}}),U.prototype=Object.assign(Object.create(F.prototype),{constructor:U,_updateA:function(){null==this.target&&(this.target=new y.THREE.Vector3(0,0,0)),this.target.set(this._a[0]-this.parent.size.width/2,-this._a[1]+this.parent.size.height/2,-this._a[2]),this.rotateUpdate=!0},_updateR:function(){this.target?(this.el.lookAt(this.target),this.rotateEuler.set(this._rx*F.Radian,-this._ry*F.Radian,-this._rz*F.Radian),this.rotateQuat.setFromEuler(this.rotateEuler,!1),this.el.quaternion.premultiply(this.rotateQuat)):this.el.rotation.set(this._rx*F.Radian,-this._ry*F.Radian,-this._rz*F.Radian),0===this._or[0]&&0===this._or[1]&&0===this._or[2]||(this.orientEuler.set(this._or[0]*F.Radian,-this._or[1]*F.Radian,-this._or[2]*F.Radian),this.orientQuat.setFromEuler(this.orientEuler,!1),this.el.quaternion.premultiply(this.orientQuat))}}),P.prototype=Object.assign(Object.create(F.prototype),{constructor:P,_updateO:function(t,i){},_initLayers:function(t){for(var i=this,e=0,s=t.length;e<s;e++){var a=t[e];switch(a.ty){case 1:var h=new U(a,this);this.layers[a.ind-1]=h,this.cameras.push(h),h._addSelf=function(){i.activeCamera=this.el,i._addCamera(this.el),this.onAdd&&this.onAdd.call(this)},h._removeSelf=function(){i.activeCamera==this.el&&(i.activeCamera=null),i._removeCamera(this.el),this.onRemove&&this.onRemove.call(this)};break;case 14:h=new P(a,this,this.compAssets[a.refId],this.imageAssets,this.compAssets);(this.layers[a.ind-1]=h)._addSelf=function(){this.activeCamera&&(i.activeCamera=this.activeCamera),i.el.add(this.el),this.onAdd&&this.onAdd.call(this)},h._removeSelf=function(){i.activeCamera==this.activeCamera&&(i.activeCamera=i.defaultCamera||null),i.el.remove(this.el),this.onRemove&&this.onRemove.call(this)},h._addCamera=function(t){i._addCamera(t)},h._removeCamera=function(t){i._removeCamera(t)};break;case 13:var r=new M(a,this);(this.layers[a.ind-1]=r)._addSelf=function(){i.el.add(this.el),this.onAdd&&this.onAdd.call(this)},r._removeSelf=function(){i.el.remove(this.el),this.onRemove&&this.onRemove.call(this)};break;case 12:r=new k(a,this,this.imageAssets[a.refId]);(this.layers[a.ind-1]=r)._addSelf=function(){i.el.add(this.el),this.onAdd&&this.onAdd.call(this)},r._removeSelf=function(){i.el.remove(this.el),this.onRemove&&this.onRemove.call(this)};break;case 11:var n=new C(a,this);(this.layers[a.ind-1]=n)._addSelf=function(){i.el.add(this.el),this.onAdd&&this.onAdd.call(this)},n._removeSelf=function(){i.el.remove(this.el),this.onRemove&&this.onRemove.call(this)}}}for(e=0,s=this.layers.length;e<s;e++){var o=this.layers[e];o&&o.data.parent&&(o.parentLayer=this.layers[o.data.parent-1])}},findByName:function(t){var i=[];if(Array.isArray(t))for(var e=0,s=t.length;e<s;e++)i=i.concat(this.findByName(t[e]));else for(e=0,s=this.layers.length;e<s;e++){var a=this.layers[e];a&&a.name===t&&i.push(a),a&&"comp"===a.type&&(i=i.concat(a.findByName(t)))}return i},findContainName:function(t){var i=[];if(Array.isArray(t))for(var e=0,s=t.length;e<s;e++)i=i.concat(this.findContainName(t[e]));else for(e=0,s=this.layers.length;e<s;e++){var a=this.layers[e];a&&-1!=a.name.indexOf(t)&&i.push(a),a&&"comp"===a.type&&(i=i.concat(a.findContainName(t)))}return i},findByRef:function(t){var i=[];if(Array.isArray(t))for(var e=0,s=t.length;e<s;e++)i=i.concat(this.findByRef(t[e]));else for(e=0,s=this.layers.length;e<s;e++){var a=this.layers[e];a&&a.data.refId&&a.data.refId===t&&i.push(a),a&&"comp"===a.type&&(i=i.concat(a.findByRef(t)))}return i},findContainRef:function(t){var i=[];if(Array.isArray(t))for(var e=0,s=t.length;e<s;e++)i=i.concat(this.findContainRef(t[e]));else for(e=0,s=this.layers.length;e<s;e++){var a=this.layers[e];a&&a.data.refId&&-1!=a.data.refId.indexOf(t)&&i.push(a),a&&"comp"===a.type&&(i=i.concat(a.findContainRef(t)))}return i},_addCamera:function(t){this.activeCamera=t},_removeCamera:function(t){this.activeCamera==t&&(this.activeCamera=this.defaultCamera)},setSize:function(){for(var t=y.lockWidth?this.size.width*y.height/y.width:this.size.height,i=0,e=this.cameras.length;i<e;i++){var s=this.cameras[i],a=2*Math.atan(t/2/s.data.pe.k)/Math.PI*180;s.el.fov=a,s.el.aspect=y.width/y.height,s.el.updateProjectionMatrix()}for(i=0,e=this.layers.length;i<e;i++){var h=this.layers[i];h&&"comp"==h.type&&h.setSize()}}}),j.prototype=Object.assign(Object.create(P.prototype),e.prototype,{constructor:j,_update:function(t,i){},_initImages:function(t){if(0===y.loadOrder)for(var i=0,e=t.length;i<e;i++){var s=t[i];this.imageAssets[s.id]=s}else for(i=t.length-1;0<=i;i--){s=t[i];this.imageAssets[s.id]=s}for(var i in this.imageAssets){var a=this.imageAssets[i],h=new y.THREE.Texture;this.assets[this.imageAssets[i].p]?(h.image=this.assets[this.imageAssets[i].p],h.needsUpdate=!0):u(this.path+a.u+a.p,function(t,i){i.image=t,i.needsUpdate=!0},h),h.needsUpdate=!1,a.texture=h}},_initComps:function(t){for(var i=0,e=t.length;i<e;i++){var s=t[i];this.compAssets[s.id]=s}},setSize:function(t,i){y.width=t,y.height=i,P.prototype.setSize.call(this);t=y.lockWidth?this.size.width*y.height/y.width:this.size.height,i=2*Math.atan(t/2/this.defaultZ)/Math.PI*180;this.defaultCamera.fov=i,this.defaultCamera.aspect=y.width/y.height,this.defaultCamera.updateProjectionMatrix()}}),t.Tanimation=j,t.bindScopedCanvas=function(t){y.canvas=t,y.width=t.width,y.height=t.height},t.fixed=a,t.global=y,t.loadFullJson=function(i,e,s,a,h){var r,n={},o=0;function l(t,i){n[t]=i,++o>=r?a(n):s(o/r)}p(e+i,function(t){r=(h?Math.floor(t.images.length*h):t.images.length)+1,l(i,t),t.images.forEach(function(i,t){t<r-1&&u(e+i.u+i.p,function(t){l(i.p,t)})})})},t.loadImg=u,t.loadJson=p,t.loadQueue=function(t,e,s){var a={},h=t.length,r=0;function n(t,i){a[t]=i,++r>=h?s(a):e(r/h)}t.forEach(function(t){var i=I.exec(t)[0],e=O.exec(t)[1];switch(i){case"jpeg":case"jpg":case"png":case"gif":u(t,function(t){n(e,t)});break;case"json":p(t,function(t){n(e,t)})}})},Object.defineProperty(t,"__esModule",{value:!0})});
