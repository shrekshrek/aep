/*!
 * GIT: https://github.com/shrekshrek/aep
 **/

!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e(t.AEP={})}(this,function(t){"use strict";var e={author:"shrek.wang - https://github.com/shrekshrek",version:"0.10.0",loadOrder:0,alphaTest:.05,curveSegments:10,lockWidth:!1,far:5e4,near:1,width:0,height:0,frameSegments:10,THREE:THREE};function i(t,e){var i=new XMLHttpRequest;i.open("GET",t,!0),i.onreadystatechange=function(){4==i.readyState&&200==i.status&&e(JSON.parse(i.responseText))},i.send()}function s(t,e,i){var s=new XMLHttpRequest;s.open("GET",t,!0),s.responseType="blob",s.onreadystatechange=function(){if(4==s.readyState&&200==s.status){var t=s.response,a=document.createElement("img");a.crossOrigin="anonymous",a.onload=function(){window.URL.revokeObjectURL(a.src),e(a,i)},a.src=window.URL.createObjectURL(t)}},s.send()}var a=new RegExp(".+/(.+)$"),r=new RegExp("[^\\.]\\w*$");function h(t){return Math.floor(t*e.frameSegments)/e.frameSegments}Date.now=Date.now||function(){return(new Date).getTime()};var n=Date.now();function o(){return Date.now()-n}var l=window.requestAnimationFrame||window.webkitRequestAnimationFrame||function(t){window.setTimeout(t,1e3/60)},p=[],u=[],c=[],d=[],m=!1,f=0;function _(){var t=p.length,e=c.length;if(0!==t||0!==e){var i=o(),s=i-f;f=i,s>500&&(s=33),u=p.slice(0);for(var a=0;a<t;a++){var r=u[a];r&&r.isPlaying&&!r._updateTime(s)&&r.pause()}d=c.slice(0);for(var h=0;h<e;h++){var n=d[h];n&&n.isSoloPlaying&&n._updateSoloTime(s)}l(_)}else m=!1}function v(t,e){this._frameRate=0,this._frameStep=0,this.totalTime=0,this.curTime=null,this.lastTime=null,this.timeScale=1,this.isPlaying=!1,this.isReverse=!1,this.isSoloPlaying=!1,this.soloItems=null,this.loop=e.loop||!1,this.isSeek=!1,this.isKeep=!1,this.setFrameRate(t.fr),this.onStart=e.onStart||null,this.onEnd=e.onEnd||null,this.onUpdate=e.onUpdate||null}Object.assign(v.prototype,{_updateTime:function(t){this.isKeep=!1,t=(this.isReverse?-1:1)*t*this.timeScale;var e=this.curTime;this.loop&&(0===this.curTime&&t<0?e=this.totalTime:this.curTime===this.totalTime&&t>0&&(e=0));var i=Math.min(this.totalTime,Math.max(0,e+t));if(i===this.curTime)return!0;this.lastTime=e,this.curTime=i;var s=h(this.curTime/this._frameStep);if(this._seekFrame(s+this.inFrame),!this.isSeek&&this.onUpdate&&this.onUpdate(t),this.lastTime<this.curTime){if(this.lastTime<=0&&this.curTime>0&&!this.isSeek&&this.onStart&&this.onStart(),this.lastTime<this.totalTime&&this.curTime>=this.totalTime)return!this.isSeek&&this.onEnd&&this.onEnd(),this.loop||this.isKeep}else if(this.lastTime>=this.totalTime&&this.curTime<this.totalTime&&!this.isSeek&&this.onEnd&&this.onEnd(),this.lastTime>0&&this.curTime<=0)return!this.isSeek&&this.onStart&&this.onStart(),this.loop||this.isKeep;return!0},_updateSoloTime:function(t){t=(this.isReverse?-1:1)*t*this.timeScale;for(var e=0,i=this.soloItems.length;e<i;e++)this.soloItems[e]._soloFrame(t/this._frameStep);this.isPlaying||this.isSeek||!this.onUpdate||this.onUpdate(t)},getFrameRate:function(){return this._frameRate},setFrameRate:function(t){this._frameRate=t,this._frameStep=1e3/this._frameRate,this.totalTime=this._frameStep*(this.outFrame-this.inFrame)},seek:function(t,e){var i=Math.max(0,Math.min(this.totalTime,t));this.curTime!==i&&(this.isSeek=e||!1,this._updateTime((this.isReverse?-1:1)*(i-this.curTime)),this.isSeek=!1)},prev:function(){this.seek(this.curTime-this._frameStep)},next:function(){this.seek(this.curTime+this._frameStep)},play:function(t){if(this.isReverse=!1,void 0!==t&&this.seek(t,!0),!this.loop&&this.curTime===this.totalTime)return this.isKeep=!1;this.isKeep=!0,this.isPlaying||(this.isPlaying=!0,this._addTimeline())},pause:function(){this.isKeep=!1,this.isPlaying&&(this.isPlaying=!1,this._removeTimeline())},stop:function(){this.pause(),this.curTime=0},reverse:function(t){if(this.isReverse=!0,void 0!==t&&this.seek(t,!0),!this.loop&&0===this.curTime)return this.isKeep=!1;this.isKeep=!0,this.isPlaying||(this.isPlaying=!0,this._addTimeline())},_addTimeline:function(){p.push(this),m||(f=o(),m=!0,l(_))},_removeTimeline:function(){var t=p.indexOf(this);-1!==t&&p.splice(t,1)},solo:function(t){if(this.soloItems){for(var e=0,i=this.soloItems.length;e<i;e++)this.soloItems[e].isSolo=!1;this.soloItems=null,this.pauseSolo()}if(t&&t.length){this.soloItems=[];for(e=0,i=t.length;e<i;e++)"comp"==t[e].type&&(t[e].isSolo=!0,this.soloItems.push(t[e]));this.playSolo()}else t&&"comp"==t.type&&(t.isSolo=!0,this.soloItems=[t],this.playSolo())},playSolo:function(){!this.isSoloPlaying&&this.soloItems&&(this.isSoloPlaying=!0,this._addSoloTimeline())},pauseSolo:function(){this.isSoloPlaying&&(this.isSoloPlaying=!1,this._removeSoloTimeline())},_addSoloTimeline:function(){c.push(this),m||(f=o(),m=!0,l(_))},_removeSoloTimeline:function(){var t=c.indexOf(this);-1!==t&&c.splice(t,1)}});var y=function(){var t={getBezierEasing:function(t,i,s,a,r){var h=r||("bez_"+t+"_"+i+"_"+s+"_"+a).replace(/\./g,"p");if(e[h])return e[h];var n=new d([t,i,s,a]);return e[h]=n,n}},e={};var i=4,s=1e-7,a=10,r=11,h=1/(r-1),n="function"==typeof Float32Array;function o(t,e){return 1-3*e+3*t}function l(t,e){return 3*e-6*t}function p(t){return 3*t}function u(t,e,i){return((o(e,i)*t+l(e,i))*t+p(e))*t}function c(t,e,i){return 3*o(e,i)*t*t+2*l(e,i)*t+p(e)}function d(t){this._p=t,this._mSampleValues=n?new Float32Array(r):new Array(r),this._precomputed=!1,this.get=this.get.bind(this)}return d.prototype={get:function(t){var e=this._p[0],i=this._p[1],s=this._p[2],a=this._p[3];return this._precomputed||this._precompute(),e===i&&s===a?t:0===t?0:1===t?1:u(this._getTForX(t),i,a)},_precompute:function(){var t=this._p[0],e=this._p[1],i=this._p[2],s=this._p[3];this._precomputed=!0,t===e&&i===s||this._calcSampleValues()},_calcSampleValues:function(){for(var t=this._p[0],e=this._p[2],i=0;i<r;++i)this._mSampleValues[i]=u(i*h,t,e)},_getTForX:function(t){for(var e=this._p[0],n=this._p[2],o=this._mSampleValues,l=0,p=1,d=r-1;p!==d&&o[p]<=t;++p)l+=h;var m=l+(t-o[--p])/(o[p+1]-o[p])*h,f=c(m,e,n);return f>=.001?function(t,e,s,a){for(var r=0;r<i;++r){var h=c(e,s,a);if(0===h)return e;e-=(u(e,s,a)-t)/h}return e}(t,m,e,n):0===f?m:function(t,e,i,r,h){var n,o,l=0;do{(n=u(o=e+(i-e)/2,r,h)-t)>0?i=o:e=o}while(Math.abs(n)>s&&++l<a);return o}(t,l,l+h,e,n)}},t}();var g=function(){function t(t,e,i){this.length=t,this.ptDistance=e,this.point=i}var i;return{buildBezierData:(i={},function(s,a){var r=s.s,h=s.e,n=s.to,o=s.ti,l=(r.join("_")+"_"+h.join("_")+"_"+n.join("_")+"_"+o.join("_")).replace(/\./g,"p");if(i[l])return i[l];var p,u,c,d,m,f,_,v=Math.max(Math.min(Math.round(a),e.curveSegments),2),y=0,g=null,w=new function(t){this.segmentLength=0,this.points=new Array(t)}(v);for(c=n.length,p=0;p<v;p+=1){for(_=new Array(c),m=p/(v-1),f=0,u=0;u<c;u+=1)d=Math.pow(1-m,3)*r[u]+3*Math.pow(1-m,2)*m*(r[u]+n[u])+3*(1-m)*Math.pow(m,2)*(h[u]+o[u])+Math.pow(m,3)*h[u],_[u]=d,null!==g&&(f+=Math.pow(_[u]-g[u],2));y+=f=Math.sqrt(f),w.points[p]=new t(y,f,_),g=_}return w.segmentLength=y,i[l]=w,w})}}();function w(t){this.data=t,this.frames=[],this.easings=[],this.beziers=[]}function S(t,e){this.name=t,this.isAnim=1===e.a,"or"==this.name&&this.isAnim&&function(t){for(var e in t.k){var i=t.k[e];for(var s in i.s)i.to[s]=i.ti[s]=0,i.e[s]-i.s[s]>180&&(i.s[s]+=360),i.e[s]-i.s[s]<-180&&(i.s[s]-=360)}}(e),this.isAnim?this.keys=new w(e.k):this.value=e.k}function T(t,e){if(t&&t.length){for(var i in t)if(t[i]!==e[i])return!1;return!0}return t===e}function R(t,e){for(var i in this.data=t,this.type="",this.name=t.nm,this.size={width:0,height:0},this.startFrame=t.st||0,this.inFrame=t.ip,this.outFrame=t.op,this.curFrame=null,this.curSoloFrame=null,this.curUpdateFrame=null,this.scaleRate=t.sr||1,this.parentLayer=null,this.parent=e,this.property={},t.tf)"p"===i&&!0===t.tf[i].s?(t.tf[i].x&&(this.property.x=new S("x",t.tf[i].x)),t.tf[i].y&&(this.property.y=new S("y",t.tf[i].y)),t.tf[i].z&&(this.property.z=new S("z",t.tf[i].z))):this.property[i]=new S(i,t.tf[i]);this.visible=!1,this.positionUpdate=!1,this.rotateUpdate=!1,this.needsUpdate=!1,this.isMoved=!1,this.isClosed=!1,this._a=null,this._o=null,this._s=null,this._or=null,this._rx=null,this._ry=null,this._rz=null,this._p=null,this._x=null,this._y=null,this._z=null}function E(t,i){R.call(this,t,i),this.orientEuler=new e.THREE.Euler,this.orientQuat=new e.THREE.Quaternion,this.anchorMatrix=new e.THREE.Matrix4}function x(t,i,s){E.call(this,t,i),this.type="image",this.image=s,this.size={width:this.image.w,height:this.image.h},this.mat=new e.THREE.MeshBasicMaterial({map:this.image.texture,side:e.THREE.DoubleSide,transparent:!0,alphaTest:e.alphaTest}),this.geo=new e.THREE.PlaneBufferGeometry(this.size.width,this.size.height,1,1),this.el=new e.THREE.Mesh(this.geo,this.mat),this.el.le=this,this.el.matrixAutoUpdate=!1}function A(t,i){E.call(this,t,i),this.type="solid",this.size={width:t.sw,height:t.sh},this.mat=new e.THREE.MeshBasicMaterial({color:Number("0x"+t.sc.substring(1)),side:e.THREE.DoubleSide,transparent:!0}),this.geo=new e.THREE.PlaneBufferGeometry(this.size.width,this.size.height,1,1),this.el=new e.THREE.Mesh(this.geo,this.mat),this.el.le=this,this.el.matrixAutoUpdate=!1}function z(t,i){E.call(this,t,i),this.type="null object",this.el=new e.THREE.Object3D,this.el.le=this,this.el.matrixAutoUpdate=!1}function b(t,i){E.call(this,t,i),this.type="camera",this.target=null;var s=e.lockWidth?this.parent.size.width*e.height/e.width:this.parent.size.height,a=2*Math.atan(s/2/t.pe.k)/Math.PI*180;this.el=new e.THREE.PerspectiveCamera(a,e.width/e.height,e.near,e.far),this.el.le=this,this.el.matrixAutoUpdate=!1,this.rotateEuler=new e.THREE.Euler,this.rotateQuat=new e.THREE.Quaternion}function k(t,i,s,a,r){E.call(this,t,i),this.type="comp",this.imageAssets=a,this.compAssets=r,this.size={width:t.w,height:t.h},this.el=new e.THREE.Group,this.el.le=this,this.el.matrixAutoUpdate=!1,this.workStart=t.ws,this.workDuration=t.wd,this.isSolo=!1,this.layers=[],this.cameras=[],this.activeCamera=null,this._initLayers(s.layers)}function M(t,i){-1==t.git.indexOf("shrek")&&-1==e.author.indexOf("shrek")||(this.path=i&&i.path,this.imageAssets={},this.compAssets={},this.assets=i&&i.assets||{},this._initImages(t.images),this._initComps(t.comps),k.call(this,t,null,t,this.imageAssets,this.compAssets),v.call(this,t,i),this.type="animation",this.defaultZ=2666,this.defaultCamera=new e.THREE.PerspectiveCamera(75,e.width/e.height,e.near,e.far),this.defaultCamera.position.set(0,0,this.defaultZ),this.activeCamera=this.defaultCamera,this.setSize(i.width||window.innerWidth,i.height||window.innerHeight))}Object.assign(w.prototype,{update:function(t){if(this.frames[t])return this.frames[t];for(var e=this.data.length,i=e-1;i>=0;i--){var s=this.data[i];if(t>=s.t){if(i==e-1)this.frames[t]=this.data[i-1].e;else{if(void 0===this.easings[i])if(s.o.x.constructor===Array){var a=[];for(var r in s.o.x)a[r]=y.getBezierEasing(s.o.x[r],s.o.y[r],s.i.x[r],s.i.y[r],s.n[r]).get;this.easings[i]=a}else this.easings[i]=y.getBezierEasing(s.o.x,s.o.y,s.i.x,s.i.y,s.n).get;var h=this.easings[i],n=(t-s.t)/(this.data[i+1].t-s.t),o=[];if(s.to){void 0===this.beziers[i]&&(this.beziers[i]=g.buildBezierData(s,this.data[i+1].t-s.t));var l=this.beziers[i];for(var p in s.s){for(var u=h.constructor===Array?h[p](n):h(n),c=l.segmentLength*u,d=1,m=l.points.length,f=0;f<m;f++)if(c<l.points[f].length){d=f;break}var _=0!=l.points[d].ptDistance?(c-l.points[d-1].length)/l.points[d].ptDistance:0;o[p]=l.points[d].point[p]*_+l.points[d-1].point[p]*(1-_)}}else for(var p in s.s){var v=s.s,w=s.e;u=h.constructor===Array?h[p](n):h(n);o[p]=v[p]+(w[p]-v[p])*u}this.frames[t]=o}return this.frames[t]}}return this.frames[t]=this.data[0].s,this.frames[t]}}),Object.assign(S.prototype,{update:function(t){return this.isAnim?this.keys.update(t):this.value}}),Object.assign(R.prototype,{open:function(){return this.isClosed=!1,this.visible&&this._addSelf(),this},close:function(){return this.isClosed=!0,this.el.parent&&this.el.parent.remove(this.el),this},_seekFrame:function(t){if(!this.isClosed&&this.curFrame!==t)if(this.curFrame=t,this.curFrame>=this.inFrame&&this.curFrame<this.outFrame){if(this.visible?this._update(this.curFrame,!1):(this.visible=!0,this._addSelf(),this._update(this.curFrame,!0)),this.layers&&!this.isSolo)for(var e=0,i=this.layers.length;e<i;e++){var s=this.layers[e];s&&s._seekFrame((this.curFrame-this.startFrame)/this.scaleRate)}}else this.visible&&(this.visible=!1,this._removeSelf())},_soloFrame:function(t){if(this.visible){var e=h((this.curSoloFrame+t-this.workStart)%this.workDuration);if(this.curSoloFrame=this.workStart+e+(e<0?this.workDuration:0),this.layers&&this.isSolo)for(var i=0,s=this.layers.length;i<s;i++){var a=this.layers[i];a&&a._seekFrame(this.curSoloFrame/this.scaleRate)}}},_addSelf:function(){},_removeSelf:function(){},_update:function(t,e){if(this.curUpdateFrame!==t){if(this.curUpdateFrame=t,this.positionUpdate=!1,this.rotateUpdate=!1,this.needsUpdate=!1,this.isMoved=!1,this.property.o){var i=this.property.o.update(t);this.parent&&(i*=(this.parent._o||100)/100),T(this._o,i)||(this._o=i,this._updateO())}if(this.property.p){var s=this.property.p.update(t);T(this._p,s)||(this.isMoved=!0,this._p=s,this._x=s[0],this._y=s[1],this._z=s[2],this.positionUpdate=!0)}if(this.property.x){var a=this.property.x.update(t);T(this._x,a)||(this.isMoved=!0,this._x=a,this.positionUpdate=!0)}if(this.property.y){var r=this.property.y.update(t);T(this._y,r)||(this.isMoved=!0,this._y=r,this.positionUpdate=!0)}if(this.property.z){var h=this.property.z.update(t);T(this._z,h)||(this.isMoved=!0,this._z=h,this.positionUpdate=!0)}if(this.positionUpdate&&(this._updateP(),this.needsUpdate=!0),this.property.a){var n=this.property.a.update(t);("camera"===this.type&&this.isMoved||!T(this._a,n))&&(this._a=n,this._updateA(),this.needsUpdate=!0)}if(this.property.s){var o=this.property.s.update(t);T(this._s,o)||(this._s=o,this._updateS(),this.needsUpdate=!0)}if(this.property.rx){var l=this.property.rx.update(t);T(this._rx,l)||(this._rx=l,this.rotateUpdate=!0)}if(this.property.ry){var p=this.property.ry.update(t);T(this._ry,p)||(this._ry=p,this.rotateUpdate=!0)}if(this.property.rz){var u=this.property.rz.update(t);T(this._rz,u)||(this._rz=u,this.rotateUpdate=!0)}if(this.property.or){var c=this.property.or.update(t);T(this._or,c)||(this._or=c,this.rotateUpdate=!0)}this.rotateUpdate&&(this._updateR(),this.needsUpdate=!0),this.needsUpdate&&this._updateSelf(),this.parentLayer&&(this.parentLayer._update(t),(this.parentLayer.needsUpdate||this.needsUpdate||e)&&(this.needsUpdate||(this._updateSelf(),this.needsUpdate=!0),this._updateFromParent()))}},_updateO:function(){},_updateP:function(){},_updateA:function(){},_updateS:function(){},_updateR:function(){},_updateSelf:function(){},_updateFromSelf:function(){},_updateFromParent:function(){}}),E.Radian=Math.PI/180,E.prototype=Object.assign(Object.create(R.prototype),{constructor:E,_updateO:function(){this.mat.opacity=this._o/100},_updateP:function(){var t=this.parent?this.parent.size.width:0,e=this.parent?this.parent.size.height:0;this.el.position.set(this._x-t/2,-this._y+e/2,-this._z)},_updateA:function(){this.anchorMatrix.makeTranslation(-this._a[0]+this.size.width/2,this._a[1]-this.size.height/2,this._a[2])},_updateS:function(){this.el.scale.set(this._s[0]/100,this._s[1]/100,this._s[2]/100)},_updateR:function(){this.el.rotation.set(this._rx*E.Radian,-this._ry*E.Radian,-this._rz*E.Radian),0===this._or[0]&&0===this._or[1]&&0===this._or[2]||(this.orientEuler.set(this._or[0]*E.Radian,-this._or[1]*E.Radian,-this._or[2]*E.Radian),this.orientQuat.setFromEuler(this.orientEuler,!1),this.el.quaternion.premultiply(this.orientQuat))},_updateSelf:function(){this.el.updateMatrix(),"camera"!=this.type&&this.el.matrix.multiplyMatrices(this.el.matrix,this.anchorMatrix)},_updateFromParent:function(){var t=this.parent?this.parent.size.width:0,e=this.parent?this.parent.size.height:0;this.el.matrix.elements[12]+=t/2-this.parentLayer.size.width/2,this.el.matrix.elements[13]-=e/2-this.parentLayer.size.height/2,this.el.matrix.multiplyMatrices(this.parentLayer.el.matrix,this.el.matrix),this.el.matrixWorldNeedsUpdate=!0}}),x.prototype=Object.assign(Object.create(E.prototype),{constructor:x}),A.prototype=Object.assign(Object.create(E.prototype),{constructor:A}),z.prototype=Object.assign(Object.create(E.prototype),{constructor:z,_updateO:function(t,e){}}),b.prototype=Object.assign(Object.create(E.prototype),{constructor:b,_updateA:function(){null==this.target&&(this.target=new e.THREE.Vector3(0,0,0)),this.target.set(this._a[0]-this.parent.size.width/2,-this._a[1]+this.parent.size.height/2,-this._a[2]),this.rotateUpdate=!0},_updateR:function(){this.target?(this.el.lookAt(this.target),this.rotateEuler.set(this._rx*E.Radian,-this._ry*E.Radian,-this._rz*E.Radian),this.rotateQuat.setFromEuler(this.rotateEuler,!1),this.el.quaternion.premultiply(this.rotateQuat)):this.el.rotation.set(this._rx*E.Radian,-this._ry*E.Radian,-this._rz*E.Radian),0===this._or[0]&&0===this._or[1]&&0===this._or[2]||(this.orientEuler.set(this._or[0]*E.Radian,-this._or[1]*E.Radian,-this._or[2]*E.Radian),this.orientQuat.setFromEuler(this.orientEuler,!1),this.el.quaternion.premultiply(this.orientQuat))}}),k.prototype=Object.assign(Object.create(E.prototype),{constructor:k,_updateO:function(t,e){},_initLayers:function(t){for(var e=this,i=0,s=t.length;i<s;i++){var a=t[i];switch(a.ty){case 1:var r=new b(a,this);this.layers[a.ind-1]=r,this.cameras.push(r),r._addSelf=function(){e.activeCamera=this.el,e._addCamera(this.el),this.onAdd&&this.onAdd.call(this)},r._removeSelf=function(){e.activeCamera==this.el&&(e.activeCamera=null),e._removeCamera(this.el),this.onRemove&&this.onRemove.call(this)};break;case 14:var h=new k(a,this,this.compAssets[a.refId],this.imageAssets,this.compAssets);this.layers[a.ind-1]=h,h._addSelf=function(){this.activeCamera&&(e.activeCamera=this.activeCamera),e.el.add(this.el),this.onAdd&&this.onAdd.call(this)},h._removeSelf=function(){e.activeCamera==this.activeCamera&&(e.activeCamera=e.defaultCamera||null),e.el.remove(this.el),this.onRemove&&this.onRemove.call(this)},h._addCamera=function(t){e._addCamera(t)},h._removeCamera=function(t){e._removeCamera(t)};break;case 13:var n=new A(a,this);this.layers[a.ind-1]=n,n._addSelf=function(){e.el.add(this.el),this.onAdd&&this.onAdd.call(this)},n._removeSelf=function(){e.el.remove(this.el),this.onRemove&&this.onRemove.call(this)};break;case 12:var o=new x(a,this,this.imageAssets[a.refId]);this.layers[a.ind-1]=o,o._addSelf=function(){e.el.add(this.el),this.onAdd&&this.onAdd.call(this)},o._removeSelf=function(){e.el.remove(this.el),this.onRemove&&this.onRemove.call(this)};break;case 11:var l=new z(a,this);this.layers[a.ind-1]=l,l._addSelf=function(){e.el.add(this.el),this.onAdd&&this.onAdd.call(this)},l._removeSelf=function(){e.el.remove(this.el),this.onRemove&&this.onRemove.call(this)}}}for(i=0,s=this.layers.length;i<s;i++){var p=this.layers[i];p&&p.data.parent&&(p.parentLayer=this.layers[p.data.parent-1])}},findByName:function(t){var e=[];if(Array.isArray(t))for(var i=0,s=t.length;i<s;i++)e=e.concat(this.findByName(t[i]));else for(i=0,s=this.layers.length;i<s;i++){var a=this.layers[i];a&&a.name===t&&e.push(a),a&&"comp"===a.type&&(e=e.concat(a.findByName(t)))}return e},findContainName:function(t){var e=[];if(Array.isArray(t))for(var i=0,s=t.length;i<s;i++)e=e.concat(this.findContainName(t[i]));else for(i=0,s=this.layers.length;i<s;i++){var a=this.layers[i];a&&-1!=a.name.indexOf(t)&&e.push(a),a&&"comp"===a.type&&(e=e.concat(a.findContainName(t)))}return e},findByRef:function(t){var e=[];if(Array.isArray(t))for(var i=0,s=t.length;i<s;i++)e=e.concat(this.findByRef(t[i]));else for(i=0,s=this.layers.length;i<s;i++){var a=this.layers[i];a&&a.data.refId&&a.data.refId===t&&e.push(a),a&&"comp"===a.type&&(e=e.concat(a.findByRef(t)))}return e},findContainRef:function(t){var e=[];if(Array.isArray(t))for(var i=0,s=t.length;i<s;i++)e=e.concat(this.findContainRef(t[i]));else for(i=0,s=this.layers.length;i<s;i++){var a=this.layers[i];a&&a.data.refId&&-1!=a.data.refId.indexOf(t)&&e.push(a),a&&"comp"===a.type&&(e=e.concat(a.findContainRef(t)))}return e},_addCamera:function(t){this.activeCamera=t},_removeCamera:function(t){this.activeCamera==t&&(this.activeCamera=this.defaultCamera)},setSize:function(){for(var t=e.lockWidth?this.size.width*e.height/e.width:this.size.height,i=0,s=this.cameras.length;i<s;i++){var a=this.cameras[i],r=2*Math.atan(t/2/a.data.pe.k)/Math.PI*180;a.el.fov=r,a.el.aspect=e.width/e.height,a.el.updateProjectionMatrix()}for(i=0,s=this.layers.length;i<s;i++){var h=this.layers[i];h&&"comp"==h.type&&h.setSize()}}}),M.prototype=Object.assign(Object.create(k.prototype),v.prototype,{constructor:M,_update:function(t,e){},_initImages:function(t){if(0===e.loadOrder)for(var i=0,a=t.length;i<a;i++){var r=t[i];this.imageAssets[r.id]=r}else for(i=t.length-1;i>=0;i--){r=t[i];this.imageAssets[r.id]=r}for(var i in this.imageAssets){var h=this.imageAssets[i],n=new e.THREE.Texture;this.assets[this.imageAssets[i].p]?(n.image=this.assets[this.imageAssets[i].p],n.needsUpdate=!0):s(this.path+h.u+h.p,function(t,e){e.image=t,e.needsUpdate=!0},n),n.needsUpdate=!1,h.texture=n}},_initComps:function(t){for(var e=0,i=t.length;e<i;e++){var s=t[e];this.compAssets[s.id]=s}},setSize:function(t,i){e.width=t,e.height=i,k.prototype.setSize.call(this);var s=e.lockWidth?this.size.width*e.height/e.width:this.size.height,a=2*Math.atan(s/2/this.defaultZ)/Math.PI*180;this.defaultCamera.fov=a,this.defaultCamera.aspect=e.width/e.height,this.defaultCamera.updateProjectionMatrix()}}),t.Tanimation=M,t.global=e,t.loadJson=i,t.loadImg=s,t.loadQueue=function(t,e,h){var n={},o=t.length,l=0;function p(t,i){n[t]=i,++l>=o?h(n):e(l/o)}t.forEach(function(t){var e=r.exec(t)[0],h=a.exec(t)[1];switch(e){case"jpeg":case"jpg":case"png":case"gif":s(t,function(t){p(h,t)});break;case"json":i(t,function(t){p(h,t)})}})},t.loadFullJson=function(t,e,a,r,h){var n={},o=0,l=0;function p(t,e){n[t]=e,++l>=o?r(n):a(l/o)}i(e+t,function(i){o=(h?Math.floor(i.images.length*h):i.images.length)+1,p(t,i),i.images.forEach(function(t,i){i<o-1&&s(e+t.u+t.p,function(e){p(t.p,e)})})})},t.fixed=h,Object.defineProperty(t,"__esModule",{value:!0})});
